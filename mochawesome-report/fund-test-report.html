<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets\app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:8,&quot;tests&quot;:21,&quot;passes&quot;:21,&quot;pending&quot;:0,&quot;failures&quot;:0,&quot;start&quot;:&quot;2025-12-12T08:45:07.338Z&quot;,&quot;end&quot;:&quot;2025-12-12T08:45:07.791Z&quot;,&quot;duration&quot;:453,&quot;testsRegistered&quot;:21,&quot;passPercent&quot;:100,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false},&quot;results&quot;:[{&quot;uuid&quot;:&quot;52968404-7c4d-4118-a356-276795fdc0de&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;042264fd-d397-43bf-a205-4739c998c387&quot;,&quot;title&quot;:&quot;CrowdfundingFactory.sol - createCampaign()&quot;,&quot;fullFile&quot;:&quot;C:\\MB Files\\Projects\\Portfolio Projects Website\\HelpChain Website\\helpchain-be\\test\\1-crowdfundingFactoryCreateCampaign.test.js&quot;,&quot;file&quot;:&quot;\\test\\1-crowdfundingFactoryCreateCampaign.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;CrowdfundingFactory.sol - createCampaign()\&quot;&quot;,&quot;fullTitle&quot;:&quot;CrowdfundingFactory.sol - createCampaign() \&quot;before each\&quot; hook in \&quot;CrowdfundingFactory.sol - createCampaign()\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;[owner, user1] = await ethers.getSigners();\nCrowdfundingFactory = await ethers.getContractFactory(\&quot;CrowdfundingFactory\&quot;);\nfactory = await CrowdfundingFactory.deploy();\nawait factory.waitForDeployment();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c9786245-a2a6-4e56-87b6-b5b5a0e71d3d&quot;,&quot;parentUUID&quot;:&quot;042264fd-d397-43bf-a205-4739c998c387&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should create a new campaign successfully&quot;,&quot;fullTitle&quot;:&quot;CrowdfundingFactory.sol - createCampaign() should create a new campaign successfully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji Owner membuat campaign baru ===\&quot;);\nawait factory.connect(user1).createCampaign(\n    \&quot;Education Aid\&quot;,\n    \&quot;Bantuan pendidikan untuk anak kurang mampu\&quot;,\n    ethers.parseEther(\&quot;5\&quot;)\n);\nconst campaigns = await factory.getAllCampaigns();\nconst createdCampaign = campaigns[0];\nexpect(campaigns.length).to.equal(1);\nexpect(createdCampaign.campaignAddress).to.properAddress;\nexpect(createdCampaign.owner).to.equal(user1.address);\nconsole.log(`Alamat Campaign Baru: ${createdCampaign.campaignAddress}`);\nconsole.log(`Pemilik Campaign: ${createdCampaign.owner}`);\nconsole.log(\&quot;✅ Test berhasil - Campaign baru berhasil dibuat.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;12fa0503-a38c-409d-a42b-d6f6b0fae4d5&quot;,&quot;parentUUID&quot;:&quot;042264fd-d397-43bf-a205-4739c998c387&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;12fa0503-a38c-409d-a42b-d6f6b0fae4d5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:16,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;a3f72aa4-4840-488e-95fd-775d93a0c947&quot;,&quot;title&quot;:&quot;Crowdfunding.sol - fund()&quot;,&quot;fullFile&quot;:&quot;C:\\MB Files\\Projects\\Portfolio Projects Website\\HelpChain Website\\helpchain-be\\test\\2-crowdfundingFund.test.js&quot;,&quot;file&quot;:&quot;\\test\\2-crowdfundingFund.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - fund()\&quot;&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - fund() \&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - fund()\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;[owner, backer1, backer2] = await ethers.getSigners();\nCrowdfunding = await ethers.getContractFactory(\&quot;Crowdfunding\&quot;);\ncrowdfunding = await Crowdfunding.deploy(\n    owner.address,\n    \&quot;Clean Water Project\&quot;,\n    \&quot;Pembangunan sumur air bersih untuk desa terpencil\&quot;,\n    1000\n);\nawait crowdfunding.waitForDeployment();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ad113379-696f-460b-b3ad-0167c48ce884&quot;,&quot;parentUUID&quot;:&quot;a3f72aa4-4840-488e-95fd-775d93a0c947&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should accept valid donations and update total contributions&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - fund() should accept valid donations and update total contributions&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const donationAmount = 100;\nconsole.log(\&quot;\\n=== Kasus Uji (a): Donasi &gt; 0 ETH ===\&quot;);\n// lakukan transaksi donasi dari backer1\nconst tx = await crowdfunding.connect(backer1).fund({ value: donationAmount });\nconst receipt = await tx.wait();\nconsole.log(`Tx Hash: ${receipt.hash}`);\nconsole.log(`Gas Used: ${receipt.gasUsed.toString()}`);\n// tampilkan event yang dipicu\nconst event = receipt.logs\n    .map((log) =&gt; {\n        try {\n            return crowdfunding.interface.parseLog(log);\n        } catch {\n            return null;\n        }\n    })\n    .filter((e) =&gt; e &amp;&amp; e.name === \&quot;DonationReceived\&quot;)[0];\nif (event) {\n    console.log(`Event emitted: ${event.name}`);\n    console.log(` - backer: ${event.args.backer}`);\n    console.log(` - amount: ${event.args.amount.toString()}`);\n    console.log(` - timestamp: ${event.args.timestamp.toString()}`);\n} else {\n    console.log(\&quot;⚠️  Event DonationReceived tidak ditemukan.\&quot;);\n}\n// verifikasi saldo kontrak meningkat\nconst contractBalance = await ethers.provider.getBalance(crowdfunding.target);\nconsole.log(`Saldo kontrak setelah donasi: ${contractBalance.toString()}`);\nexpect(contractBalance).to.equal(donationAmount);\n// verifikasi totalContributions bertambah sesuai\nconst totalContributions = await crowdfunding.totalContributions();\nconsole.log(`Total kontribusi tercatat: ${totalContributions.toString()}`);\nexpect(totalContributions).to.equal(donationAmount);\n// verifikasi bahwa data backer tercatat\nconst backerData = await crowdfunding.backers(backer1.address);\nconsole.log(`Saldo kontribusi backer: ${backerData.totalContribution.toString()}`);\nexpect(backerData.totalContribution).to.equal(donationAmount);\nconsole.log(\&quot;✅ Test (a) berhasil - transaksi donasi tercatat dengan benar.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ab973c86-e111-4903-a125-a7ca51402668&quot;,&quot;parentUUID&quot;:&quot;a3f72aa4-4840-488e-95fd-775d93a0c947&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if donation amount is zero&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - fund() should revert if donation amount is zero&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (b): Donasi = 0 ETH ===\&quot;);\nawait expect(\n    crowdfunding.connect(backer2).fund({ value: 0 })\n).to.be.revertedWith(\&quot;Must fund amount greater than 0.\&quot;);\nconsole.log(\&quot;✅ Test (b) berhasil - transaksi ditolak sesuai logika.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f49baac6-8368-45bc-adce-8099a4afe44d&quot;,&quot;parentUUID&quot;:&quot;a3f72aa4-4840-488e-95fd-775d93a0c947&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ab973c86-e111-4903-a125-a7ca51402668&quot;,&quot;f49baac6-8368-45bc-adce-8099a4afe44d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:22,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;5fca1886-cff2-4473-b802-72364c869cb6&quot;,&quot;title&quot;:&quot;Crowdfunding.sol - createWithdrawRequest()&quot;,&quot;fullFile&quot;:&quot;C:\\MB Files\\Projects\\Portfolio Projects Website\\HelpChain Website\\helpchain-be\\test\\3-crowdfundingCreateWithdrawRequest.test.js&quot;,&quot;file&quot;:&quot;\\test\\3-crowdfundingCreateWithdrawRequest.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - createWithdrawRequest()\&quot;&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - createWithdrawRequest() \&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - createWithdrawRequest()\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;[owner, backer1, backer2] = await ethers.getSigners();\nCrowdfunding = await ethers.getContractFactory(\&quot;Crowdfunding\&quot;);\ncrowdfunding = await Crowdfunding.deploy(\n    owner.address,\n    \&quot;Clean Water Project\&quot;,\n    \&quot;Pembangunan sumur air bersih untuk desa terpencil\&quot;,\n    1000\n);\nawait crowdfunding.waitForDeployment();\n// Tambah saldo kontrak biar bisa buat withdraw request\nawait crowdfunding.connect(backer1).fund({ value: 500 });\nawait crowdfunding.connect(backer2).fund({ value: 700 });&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fc124a67-9cec-4aa7-a63e-be36bc34ced2&quot;,&quot;parentUUID&quot;:&quot;5fca1886-cff2-4473-b802-72364c869cb6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should allow owner to create a valid withdraw request&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - createWithdrawRequest() should allow owner to create a valid withdraw request&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (a): Owner membuat request pertama ===\&quot;);\nconst withdrawAmount = 300;\nconst votingDuration = 60; // 60 detik (dummy)\nconst tx = await crowdfunding\n    .connect(owner)\n    .createWithdrawRequest(withdrawAmount, votingDuration);\nconst receipt = await tx.wait();\nconsole.log(`Tx Hash: ${receipt.hash}`);\nconsole.log(`Gas Used: ${receipt.gasUsed.toString()}`);\n// Cek event WithdrawRequested\nconst event = receipt.logs\n    .map((log) =&gt; {\n        try {\n            return crowdfunding.interface.parseLog(log);\n        } catch {\n            return null;\n        }\n    })\n    .filter((e) =&gt; e &amp;&amp; e.name === \&quot;WithdrawRequested\&quot;)[0];\nif (event) {\n    console.log(`Event emitted: ${event.name}`);\n    console.log(` - requestId: ${event.args.requestId.toString()}`);\n    console.log(` - amount: ${event.args.amount.toString()}`);\n    console.log(` - deadline: ${event.args.deadline.toString()}`);\n} else {\n    console.log(\&quot;⚠️ Event WithdrawRequested tidak ditemukan.\&quot;);\n}\nconst count = await crowdfunding.withdrawRequestCount();\nexpect(count).to.equal(1);\nconsole.log(\&quot;✅ Test (a) berhasil - request pertama dibuat dengan benar.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b455f6e7-5373-42eb-8f15-8ad05a7ac8cc&quot;,&quot;parentUUID&quot;:&quot;5fca1886-cff2-4473-b802-72364c869cb6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if non-owner tries to create a request&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - createWithdrawRequest() should revert if non-owner tries to create a request&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (b): Non-owner mencoba membuat request ===\&quot;);\nconst withdrawAmount = 200;\nconst votingDuration = 60;\nawait expect(\n    crowdfunding\n        .connect(backer1)\n        .createWithdrawRequest(withdrawAmount, votingDuration)\n).to.be.revertedWith(\&quot;You are not the owner.\&quot;);\nconsole.log(\&quot;✅ Test (b) berhasil - Non-owner ditolak sesuai logika.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a24a6869-6366-4505-bdd5-c2aadcef2bb6&quot;,&quot;parentUUID&quot;:&quot;5fca1886-cff2-4473-b802-72364c869cb6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if owner creates new request before previous finalized&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - createWithdrawRequest() should revert if owner creates new request before previous finalized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\n    \&quot;\\n=== Kasus Uji (c): Owner mencoba request kedua sebelum finalize ===\&quot;\n);\nconst withdrawAmount = 300;\nconst votingDuration = 60;\n// Buat request pertama\nawait crowdfunding\n    .connect(owner)\n    .createWithdrawRequest(withdrawAmount, votingDuration);\n// Coba langsung buat request kedua tanpa finalize\nawait expect(\n    crowdfunding\n        .connect(owner)\n        .createWithdrawRequest(200, 60)\n).to.be.revertedWith(\&quot;Previous request not finalized.\&quot;);\nconsole.log(\&quot;✅ Test (c) berhasil - request kedua ditolak karena belum finalize.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;28b18a5a-79f8-4e0c-80ac-59d43385a858&quot;,&quot;parentUUID&quot;:&quot;5fca1886-cff2-4473-b802-72364c869cb6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b455f6e7-5373-42eb-8f15-8ad05a7ac8cc&quot;,&quot;a24a6869-6366-4505-bdd5-c2aadcef2bb6&quot;,&quot;28b18a5a-79f8-4e0c-80ac-59d43385a858&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:11,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;521cac22-e7a9-4a92-8be1-c925226b9f8d&quot;,&quot;title&quot;:&quot;Crowdfunding.sol - confirmWithdrawRequest()&quot;,&quot;fullFile&quot;:&quot;C:\\MB Files\\Projects\\Portfolio Projects Website\\HelpChain Website\\helpchain-be\\test\\4-crowdfundingConfirmWithdrawRequest.test.js&quot;,&quot;file&quot;:&quot;\\test\\4-crowdfundingConfirmWithdrawRequest.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - confirmWithdrawRequest()\&quot;&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - confirmWithdrawRequest() \&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - confirmWithdrawRequest()\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;[owner, backer1, backer2, outsider] = await ethers.getSigners();\nCrowdfunding = await ethers.getContractFactory(\&quot;Crowdfunding\&quot;);\ncrowdfunding = await Crowdfunding.deploy(\n    owner.address,\n    \&quot;Clean Water Project\&quot;,\n    \&quot;Pembangunan sumur air bersih untuk desa terpencil\&quot;,\n    1000\n);\nawait crowdfunding.waitForDeployment();\n// Fund contract\nawait crowdfunding.connect(backer1).fund({ value: 500 });\nawait crowdfunding.connect(backer2).fund({ value: 700 });\n// Owner creates withdraw request (valid)\nconst withdrawAmount = 300;\nconst votingDuration = 60;\nawait crowdfunding\n    .connect(owner)\n    .createWithdrawRequest(withdrawAmount, votingDuration);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bb27e36a-1c0e-4523-8197-519ea8d0b8c4&quot;,&quot;parentUUID&quot;:&quot;521cac22-e7a9-4a92-8be1-c925226b9f8d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should allow backer to vote YES and emit event&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - confirmWithdrawRequest() should allow backer to vote YES and emit event&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (a): Backer vote YES ===\&quot;);\nconst tx = await crowdfunding.connect(backer1).confirmWithdrawRequest(1, true);\nconst receipt = await tx.wait();\nconsole.log(`Tx Hash: ${receipt.hash}`);\nconsole.log(`Gas Used: ${receipt.gasUsed.toString()}`);\n// Decode event\nconst event = receipt.logs\n    .map((log) =&gt; {\n        try {\n            return crowdfunding.interface.parseLog(log);\n        } catch {\n            return null;\n        }\n    })\n    .filter((e) =&gt; e &amp;&amp; e.name === \&quot;WithdrawConfirmed\&quot;)[0];\nif (event) {\n    console.log(`Event emitted: ${event.name}`);\n    console.log(` - requestId: ${event.args.requestId.toString()}`);\n    console.log(` - backer: ${event.args.backer}`);\n    console.log(` - approve: ${event.args.approve}`);\n    console.log(` - weight: ${event.args.weight.toString()}`);\n}\n// Verify weight = totalContribution\nconst backerData = await crowdfunding.backers(backer1.address);\nexpect(event.args.weight).to.equal(backerData.totalContribution);\n// Verify vote stored as YES (1)\nconst vote = await crowdfunding.getVote(1, backer1.address);\nexpect(vote).to.equal(1);\nconsole.log(\&quot;✅ Test (a) berhasil - voting YES tercatat dengan bobot sesuai kontribusi.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f80efb47-1d7b-469e-bd1f-6ec4bef6fb7d&quot;,&quot;parentUUID&quot;:&quot;521cac22-e7a9-4a92-8be1-c925226b9f8d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow backer to vote NO and record correctly&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - confirmWithdrawRequest() should allow backer to vote NO and record correctly&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (b): Backer vote NO ===\&quot;);\nconst tx = await crowdfunding.connect(backer2).confirmWithdrawRequest(1, false);\nconst receipt = await tx.wait();\nconsole.log(`Tx Hash: ${receipt.hash}`);\nconsole.log(`Gas Used: ${receipt.gasUsed.toString()}`);\nconst event = receipt.logs\n    .map((log) =&gt; {\n        try {\n            return crowdfunding.interface.parseLog(log);\n        } catch {\n            return null;\n        }\n    })\n    .filter((e) =&gt; e &amp;&amp; e.name === \&quot;WithdrawConfirmed\&quot;)[0];\nif (event) {\n    console.log(`Event emitted: ${event.name}`);\n    console.log(` - requestId: ${event.args.requestId.toString()}`);\n    console.log(` - backer: ${event.args.backer}`);\n    console.log(` - approve: ${event.args.approve}`);\n    console.log(` - weight: ${event.args.weight.toString()}`);\n}\n// Verify NO vote stored (2)\nconst vote = await crowdfunding.getVote(1, backer2.address);\nexpect(vote).to.equal(2);\nconsole.log(\&quot;✅ Test (b) berhasil - voting NO tercatat dengan benar.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f8946663-38b3-41bc-b927-2ee5b1be0304&quot;,&quot;parentUUID&quot;:&quot;521cac22-e7a9-4a92-8be1-c925226b9f8d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if non-backer tries to vote&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - confirmWithdrawRequest() should revert if non-backer tries to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (c): Non-backer mencoba vote ===\&quot;);\nawait expect(\n    crowdfunding.connect(outsider).confirmWithdrawRequest(1, true)\n).to.be.revertedWith(\&quot;Not a backer.\&quot;);\nconsole.log(\&quot;✅ Test (c) berhasil - Non-backer ditolak sesuai logika.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dc3c5e7f-99ae-4a45-bc10-5a59aff2a355&quot;,&quot;parentUUID&quot;:&quot;521cac22-e7a9-4a92-8be1-c925226b9f8d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if backer tries to vote twice&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - confirmWithdrawRequest() should revert if backer tries to vote twice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (d): Backer mencoba vote dua kali ===\&quot;);\n// First vote\nawait crowdfunding.connect(backer1).confirmWithdrawRequest(1, true);\n// Second vote attempt\nawait expect(\n    crowdfunding.connect(backer1).confirmWithdrawRequest(1, false)\n).to.be.revertedWith(\&quot;Already confirmed.\&quot;);\nconsole.log(\&quot;✅ Test (d) berhasil - voting kedua ditolak.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ea65499f-3f64-4392-be3b-85bb61df7502&quot;,&quot;parentUUID&quot;:&quot;521cac22-e7a9-4a92-8be1-c925226b9f8d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f80efb47-1d7b-469e-bd1f-6ec4bef6fb7d&quot;,&quot;f8946663-38b3-41bc-b927-2ee5b1be0304&quot;,&quot;dc3c5e7f-99ae-4a45-bc10-5a59aff2a355&quot;,&quot;ea65499f-3f64-4392-be3b-85bb61df7502&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:13,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;e3aeba6e-a6da-4773-92c9-904eec4bd4c9&quot;,&quot;title&quot;:&quot;Crowdfunding.sol - finalizeWithdrawRequest()&quot;,&quot;fullFile&quot;:&quot;C:\\MB Files\\Projects\\Portfolio Projects Website\\HelpChain Website\\helpchain-be\\test\\5-crowdfundingFinalizeWithdrawRequest.test.js&quot;,&quot;file&quot;:&quot;\\test\\5-crowdfundingFinalizeWithdrawRequest.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - finalizeWithdrawRequest()\&quot;&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - finalizeWithdrawRequest() \&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - finalizeWithdrawRequest()\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;[owner, backer1, backer2] = await ethers.getSigners();\nCrowdfunding = await ethers.getContractFactory(\&quot;Crowdfunding\&quot;);\ncrowdfunding = await Crowdfunding.deploy(\n    owner.address,\n    \&quot;Clean Water Project\&quot;,\n    \&quot;Pembangunan sumur air bersih untuk desa terpencil\&quot;,\n    ethers.parseEther(\&quot;10\&quot;)\n);\nawait crowdfunding.waitForDeployment();\n// Backers fund total 10 ETH\nawait crowdfunding.connect(backer1).fund({ value: ethers.parseEther(\&quot;4\&quot;) });\nawait crowdfunding.connect(backer2).fund({ value: ethers.parseEther(\&quot;6\&quot;) });\n// Owner creates withdraw request\nconst withdrawAmount = ethers.parseEther(\&quot;5\&quot;); // request 5 ETH\nconst votingDuration = 1; // 1 detik\nawait crowdfunding.connect(owner).createWithdrawRequest(withdrawAmount, votingDuration);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;75e4d0a5-189c-414e-8d76-e831f43cbb49&quot;,&quot;parentUUID&quot;:&quot;e3aeba6e-a6da-4773-92c9-904eec4bd4c9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should finalize successfully when YES votes are enough&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - finalizeWithdrawRequest() should finalize successfully when YES votes are enough&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (a): Voting mayoritas YES, pencairan berhasil ===\&quot;);\n// Backer2 vote YES\nawait crowdfunding.connect(backer2).confirmWithdrawRequest(1, true);\n// Backer1 tidak vote\n// Tunggu votingDuration berakhir\nawait ethers.provider.send(\&quot;evm_increaseTime\&quot;, [2]);\nawait ethers.provider.send(\&quot;evm_mine\&quot;);\n// Cek saldo owner sebelum finalize\nconst balanceBefore = await ethers.provider.getBalance(owner.address);\nconst tx = await crowdfunding.connect(owner).finalizeWithdrawRequest(1);\nconst receipt = await tx.wait();\nconsole.log(`Tx Hash: ${receipt.hash}`);\nconsole.log(`Gas Used: ${receipt.gasUsed.toString()}`);\n// Cek event WithdrawFinalized\nconst event = receipt.logs\n    .map((log) =&gt; {\n        try {\n            return crowdfunding.interface.parseLog(log);\n        } catch {\n            return null;\n        }\n    })\n    .filter((e) =&gt; e &amp;&amp; e.name === \&quot;WithdrawFinalized\&quot;)[0];\nif (event) {\n    console.log(`Event emitted: ${event.name}`);\n    console.log(` - requestId: ${event.args.requestId.toString()}`);\n    console.log(` - success: ${event.args.success}`);\n} else {\n    console.log(\&quot;⚠️ Event WithdrawFinalized tidak ditemukan.\&quot;);\n}\n// Verifikasi event success = true\nexpect(event.args.success).to.be.true;\n// Verifikasi saldo kontrak berkurang\nconst contractBalance = await ethers.provider.getBalance(crowdfunding.target);\nconsole.log(`Saldo kontrak setelah finalize: ${ethers.formatEther(contractBalance)} ETH`);\nexpect(contractBalance).to.equal(ethers.parseEther(\&quot;5\&quot;)); // 10 - 5 ETH withdrawn\n// Verifikasi owner menerima dana\nconst balanceAfter = await ethers.provider.getBalance(owner.address);\nexpect(balanceAfter).to.be.gt(balanceBefore);\nconsole.log(\&quot;✅ Test (a) berhasil - Dana dicairkan karena voting mayoritas YES.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e3370ad8-0498-4c66-b7da-e7a33e00a16a&quot;,&quot;parentUUID&quot;:&quot;e3aeba6e-a6da-4773-92c9-904eec4bd4c9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should mark campaign Failed when YES votes are not enough&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - finalizeWithdrawRequest() should mark campaign Failed when YES votes are not enough&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (b): Voting mayoritas NO, kampanye gagal ===\&quot;);\n// Backer1 vote NO\nawait crowdfunding.connect(backer1).confirmWithdrawRequest(1, false);\n// Backer2 vote NO\nawait crowdfunding.connect(backer2).confirmWithdrawRequest(1, false);\n// Tunggu waktu voting selesai\nawait ethers.provider.send(\&quot;evm_increaseTime\&quot;, [2]);\nawait ethers.provider.send(\&quot;evm_mine\&quot;);\n// Finalize withdraw (should fail)\nconst tx = await crowdfunding.connect(owner).finalizeWithdrawRequest(1);\nconst receipt = await tx.wait();\nconsole.log(`Tx Hash: ${receipt.hash}`);\nconsole.log(`Gas Used: ${receipt.gasUsed.toString()}`);\nconst event = receipt.logs\n    .map((log) =&gt; {\n        try {\n            return crowdfunding.interface.parseLog(log);\n        } catch {\n            return null;\n        }\n    })\n    .filter((e) =&gt; e &amp;&amp; e.name === \&quot;WithdrawFinalized\&quot;)[0];\nif (event) {\n    console.log(`Event emitted: ${event.name}`);\n    console.log(` - requestId: ${event.args.requestId.toString()}`);\n    console.log(` - success: ${event.args.success}`);\n}\n// Cek state campaign\nconst state = await crowdfunding.state();\nexpect(state).to.equal(2); // 0=Active, 1=Completed, 2=Failed\nexpect(event.args.success).to.be.false;\nconsole.log(\&quot;✅ Test (b) berhasil - Voting tidak mencukupi, campaign gagal.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;46387e23-6223-4d56-9332-a002dc946a13&quot;,&quot;parentUUID&quot;:&quot;e3aeba6e-a6da-4773-92c9-904eec4bd4c9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e3370ad8-0498-4c66-b7da-e7a33e00a16a&quot;,&quot;46387e23-6223-4d56-9332-a002dc946a13&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:15,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;9e5add7d-e543-491a-938e-887fa9a244f3&quot;,&quot;title&quot;:&quot;Crowdfunding.sol - submitProof()&quot;,&quot;fullFile&quot;:&quot;C:\\MB Files\\Projects\\Portfolio Projects Website\\HelpChain Website\\helpchain-be\\test\\6-crowdfundingSubmitProof.test.js&quot;,&quot;file&quot;:&quot;\\test\\6-crowdfundingSubmitProof.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - submitProof()\&quot;&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - submitProof() \&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - submitProof()\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;[owner, backer1, backer2] = await ethers.getSigners();\nCrowdfunding = await ethers.getContractFactory(\&quot;Crowdfunding\&quot;);\ncrowdfunding = await Crowdfunding.deploy(\n    owner.address,\n    \&quot;Clean Water Project\&quot;,\n    \&quot;Pembangunan sumur air bersih untuk desa terpencil\&quot;,\n    ethers.parseEther(\&quot;10\&quot;)\n);\nawait crowdfunding.waitForDeployment();\n// Fund campaign\nawait crowdfunding.connect(backer1).fund({ value: ethers.parseEther(\&quot;4\&quot;) });\nawait crowdfunding.connect(backer2).fund({ value: ethers.parseEther(\&quot;6\&quot;) });\n// Buat withdraw request\nawait crowdfunding\n    .connect(owner)\n    .createWithdrawRequest(ethers.parseEther(\&quot;5\&quot;), 1);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ae3514cb-b834-4e12-97a9-12cb4c896df9&quot;,&quot;parentUUID&quot;:&quot;9e5add7d-e543-491a-938e-887fa9a244f3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should revert if proof submitted before finalize&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - submitProof() should revert if proof submitted before finalize&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (a): Submit proof sebelum finalize ===\&quot;);\nawait expect(\n    crowdfunding.connect(owner).submitProof(1)\n).to.be.revertedWith(\&quot;Request not finalized yet.\&quot;);\nconsole.log(\&quot;✅ Test (a) berhasil - Submit sebelum finalize ditolak.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7e2e75e3-2b95-4c22-8343-f4bca82f27a1&quot;,&quot;parentUUID&quot;:&quot;9e5add7d-e543-491a-938e-887fa9a244f3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow proof submission after finalize and emit event&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - submitProof() should allow proof submission after finalize and emit event&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (b): Submit proof setelah finalize ===\&quot;);\n// Voting mayoritas YES → agar bisa finalize sukses\nawait crowdfunding.connect(backer1).confirmWithdrawRequest(1, true);\n// Tunggu voting selesai\nawait ethers.provider.send(\&quot;evm_increaseTime\&quot;, [2]);\nawait ethers.provider.send(\&quot;evm_mine\&quot;);\n// Finalize request\nawait crowdfunding.connect(owner).finalizeWithdrawRequest(1);\n// Sekarang submit proof\nconst tx = await crowdfunding.connect(owner).submitProof(1);\nconst receipt = await tx.wait();\nconsole.log(`Tx Hash: ${receipt.hash}`);\nconsole.log(`Gas Used: ${receipt.gasUsed.toString()}`);\n// Ambil event ProofSubmitted\nconst event = receipt.logs\n    .map((log) =&gt; {\n        try {\n            return crowdfunding.interface.parseLog(log);\n        } catch {\n            return null;\n        }\n    })\n    .filter((e) =&gt; e &amp;&amp; e.name === \&quot;ProofSubmitted\&quot;)[0];\nif (event) {\n    console.log(`Event emitted: ${event.name}`);\n    console.log(` - requestId: ${event.args.requestId.toString()}`);\n    console.log(` - timestamp: ${event.args.timestamp.toString()}`);\n} else {\n    console.log(\&quot;⚠️ Event ProofSubmitted tidak ditemukan.\&quot;);\n}\n// Verifikasi status proofSubmitted = true\nconst requestData = await crowdfunding.getWithdrawRequest(1);\nexpect(requestData.proofSubmitted).to.be.true;\nconsole.log(\&quot;✅ Test (b) berhasil - Proof berhasil disubmit setelah finalize.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;37c05b58-5569-4a0f-9beb-e2ff28d2361f&quot;,&quot;parentUUID&quot;:&quot;9e5add7d-e543-491a-938e-887fa9a244f3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7e2e75e3-2b95-4c22-8343-f4bca82f27a1&quot;,&quot;37c05b58-5569-4a0f-9beb-e2ff28d2361f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:8,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;025c1789-42d1-421c-96dd-271c9a09d72a&quot;,&quot;title&quot;:&quot;Crowdfunding.sol - refund()&quot;,&quot;fullFile&quot;:&quot;C:\\MB Files\\Projects\\Portfolio Projects Website\\HelpChain Website\\helpchain-be\\test\\7-crowdfundingRefund.test.js&quot;,&quot;file&quot;:&quot;\\test\\7-crowdfundingRefund.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - refund()\&quot;&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - refund() \&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - refund()\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;[owner, backer1, backer2, outsider] = await ethers.getSigners();\nCrowdfunding = await ethers.getContractFactory(\&quot;Crowdfunding\&quot;);\ncrowdfunding = await Crowdfunding.deploy(\n    owner.address,\n    \&quot;Clean Water Project\&quot;,\n    \&quot;Pembangunan sumur air bersih untuk desa terpencil\&quot;,\n    ethers.parseEther(\&quot;10\&quot;)\n);\nawait crowdfunding.waitForDeployment();\n// Tambahkan dana ke campaign\nawait crowdfunding.connect(backer1).fund({ value: ethers.parseEther(\&quot;4\&quot;) });\nawait crowdfunding.connect(backer2).fund({ value: ethers.parseEther(\&quot;6\&quot;) });\n// Owner buat withdraw request (5 ETH)\nawait crowdfunding\n    .connect(owner)\n    .createWithdrawRequest(ethers.parseEther(\&quot;5\&quot;), 1);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2fb69775-1e20-43a3-9d12-29ab1f1e96be&quot;,&quot;parentUUID&quot;:&quot;025c1789-42d1-421c-96dd-271c9a09d72a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should allow refund when campaign failed&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - refund() should allow refund when campaign failed&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (a): Refund karena campaign gagal ===\&quot;);\n// Voting mayoritas NO agar gagal\nawait crowdfunding.connect(backer1).confirmWithdrawRequest(1, false);\nawait crowdfunding.connect(backer2).confirmWithdrawRequest(1, false);\n// Tunggu waktu voting berakhir\nawait ethers.provider.send(\&quot;evm_increaseTime\&quot;, [2]);\nawait ethers.provider.send(\&quot;evm_mine\&quot;);\n// Finalize (akan gagal)\nawait crowdfunding.connect(owner).finalizeWithdrawRequest(1);\n// Refund oleh backer1\nconst tx = await crowdfunding.connect(backer1).refund();\nconst receipt = await tx.wait();\nconsole.log(`Tx Hash: ${receipt.hash}`);\nconsole.log(`Gas Used: ${receipt.gasUsed.toString()}`);\n// Ambil event RefundClaimed\nconst event = receipt.logs\n    .map((log) =&gt; {\n        try {\n            return crowdfunding.interface.parseLog(log);\n        } catch {\n            return null;\n        }\n    })\n    .filter((e) =&gt; e &amp;&amp; e.name === \&quot;RefundClaimed\&quot;)[0];\nif (event) {\n    console.log(`Event emitted: ${event.name}`);\n    console.log(` - backer: ${event.args.backer}`);\n    console.log(` - amount: ${ethers.formatEther(event.args.amount)} ETH`);\n}\n// Verifikasi totalContribution jadi 0\nconst backerData = await crowdfunding.backers(backer1.address);\nexpect(backerData.totalContribution).to.equal(0);\nconsole.log(\&quot;✅ Test (a) berhasil - Refund sukses karena campaign gagal.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;735bf377-5217-4d26-8635-a6fad541332e&quot;,&quot;parentUUID&quot;:&quot;025c1789-42d1-421c-96dd-271c9a09d72a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow refund if backer voted NO even if campaign still active&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - refund() should allow refund if backer voted NO even if campaign still active&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (b): Refund karena backer vote NO ===\&quot;);\n// Backer1 vote NO, backer2 YES\nawait crowdfunding.connect(backer1).confirmWithdrawRequest(1, false);\nawait crowdfunding.connect(backer2).confirmWithdrawRequest(1, true);\n// Belum finalize → masih state Active\nconst stateBefore = await crowdfunding.state();\nexpect(stateBefore).to.equal(0);\n// Backer1 refund karena pernah vote NO\nconst tx = await crowdfunding.connect(backer1).refund();\nconst receipt = await tx.wait();\nconst event = receipt.logs\n    .map((log) =&gt; {\n        try {\n            return crowdfunding.interface.parseLog(log);\n        } catch {\n            return null;\n        }\n    })\n    .filter((e) =&gt; e &amp;&amp; e.name === \&quot;RefundClaimed\&quot;)[0];\nconsole.log(`Event emitted: ${event.name}`);\nconsole.log(` - backer: ${event.args.backer}`);\nconsole.log(` - amount: ${ethers.formatEther(event.args.amount)} ETH`);\nconst backerData = await crowdfunding.backers(backer1.address);\nexpect(backerData.totalContribution).to.equal(0);\nconsole.log(\&quot;✅ Test (b) berhasil - Backer dengan vote NO dapat refund.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4c046af1-0618-4329-b151-f14aa62ddca5&quot;,&quot;parentUUID&quot;:&quot;025c1789-42d1-421c-96dd-271c9a09d72a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if backer has no refund rights&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - refund() should revert if backer has no refund rights&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (c): Refund gagal karena tidak memenuhi syarat ===\&quot;);\n// Belum voting apa pun, campaign masih active\nawait expect(\n    crowdfunding.connect(backer2).refund()\n).to.be.revertedWith(\&quot;Refund not allowed.\&quot;);\nconsole.log(\&quot;✅ Test (c) berhasil - Refund ditolak untuk backer tanpa hak.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3d4710d4-3ee5-4abb-acd8-88f9dfec1975&quot;,&quot;parentUUID&quot;:&quot;025c1789-42d1-421c-96dd-271c9a09d72a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;735bf377-5217-4d26-8635-a6fad541332e&quot;,&quot;4c046af1-0618-4329-b151-f14aa62ddca5&quot;,&quot;3d4710d4-3ee5-4abb-acd8-88f9dfec1975&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:15,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;51023c19-b527-4bf5-a46b-9d2d573545d3&quot;,&quot;title&quot;:&quot;Crowdfunding.sol - endCampaign()&quot;,&quot;fullFile&quot;:&quot;C:\\MB Files\\Projects\\Portfolio Projects Website\\HelpChain Website\\helpchain-be\\test\\8-crowdfundingEndCampaign.test.js&quot;,&quot;file&quot;:&quot;\\test\\8-crowdfundingEndCampaign.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - endCampaign()\&quot;&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - endCampaign() \&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - endCampaign()\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;[owner, backer1, backer2] = await ethers.getSigners();\nCrowdfunding = await ethers.getContractFactory(\&quot;Crowdfunding\&quot;);\ncrowdfunding = await Crowdfunding.deploy(\n    owner.address,\n    \&quot;Clean Water Project\&quot;,\n    \&quot;Pembangunan sumur air bersih untuk desa terpencil\&quot;,\n    ethers.parseEther(\&quot;10\&quot;) // goal = 10 ETH\n);\nawait crowdfunding.waitForDeployment();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f9b2def5-bb1d-48e3-b81d-34e6ea6eef96&quot;,&quot;parentUUID&quot;:&quot;51023c19-b527-4bf5-a46b-9d2d573545d3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should mark campaign as Completed when goal reached and all funds withdrawn&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - endCampaign() should mark campaign as Completed when goal reached and all funds withdrawn&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (a): Campaign Completed karena goal tercapai ===\&quot;);\nawait crowdfunding.connect(backer1).fund({ value: ethers.parseEther(\&quot;4\&quot;) });\nawait crowdfunding.connect(backer2).fund({ value: ethers.parseEther(\&quot;6\&quot;) });\nconst goal = await crowdfunding.goal();\nconst totalBefore = await crowdfunding.totalContributions();\nconsole.log(`Goal: ${ethers.formatEther(goal)} ETH`);\nconsole.log(`TotalContributions sebelum endCampaign: ${ethers.formatEther(totalBefore)} ETH`);\nawait crowdfunding\n    .connect(owner)\n    .createWithdrawRequest(ethers.parseEther(\&quot;10\&quot;), 1);\nawait crowdfunding.connect(backer1).confirmWithdrawRequest(1, true);\nawait crowdfunding.connect(backer2).confirmWithdrawRequest(1, true);\nawait ethers.provider.send(\&quot;evm_increaseTime\&quot;, [2]);\nawait ethers.provider.send(\&quot;evm_mine\&quot;);\nawait crowdfunding.connect(owner).finalizeWithdrawRequest(1);\nconst totalAfterFinalize = await crowdfunding.totalContributions();\nconsole.log(`TotalContributions setelah finalize: ${ethers.formatEther(totalAfterFinalize)} ETH`);\nawait crowdfunding.connect(owner).endCampaign();\nconst state = await crowdfunding.state();\nexpect(state).to.equal(1);\nconsole.log(\&quot;State akhir: Completed (1)\&quot;);\nconsole.log(\&quot;✅ Test (a) berhasil - Campaign Completed.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6270b48f-10bd-44df-b983-9d0a981dfae6&quot;,&quot;parentUUID&quot;:&quot;51023c19-b527-4bf5-a46b-9d2d573545d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if trying to end campaign while funds remain&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - endCampaign() should revert if trying to end campaign while funds remain&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (b): Gagal end campaign karena masih ada dana ===\&quot;);\nawait crowdfunding.connect(backer1).fund({ value: ethers.parseEther(\&quot;5\&quot;) });\nconst goal = await crowdfunding.goal();\nconst total = await crowdfunding.totalContributions();\nconsole.log(`Goal: ${ethers.formatEther(goal)} ETH`);\nconsole.log(`TotalContributions: ${ethers.formatEther(total)} ETH`);\nawait expect(crowdfunding.connect(owner).endCampaign()).to.be.revertedWith(\n    \&quot;All funds must be withdrawn.\&quot;\n);\nconsole.log(\&quot;✅ Test (b) berhasil - Tidak bisa end campaign sebelum dana kosong.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1d2c9b46-c294-4242-9894-4193856502b5&quot;,&quot;parentUUID&quot;:&quot;51023c19-b527-4bf5-a46b-9d2d573545d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow endCampaign() and mark as Failed if goal not reached but totalContributions already zero&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - endCampaign() should allow endCampaign() and mark as Failed if goal not reached but totalContributions already zero&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (c): Campaign Failed - goal tidak tercapai namun saldo kosong ===\&quot;);\nconst goal = await crowdfunding.goal();\nconst totalContrib = await crowdfunding.totalContributions();\nconsole.log(`Goal: ${ethers.formatEther(goal)} ETH`);\nconsole.log(`TotalContributions: ${ethers.formatEther(totalContrib)} ETH`);\nexpect(totalContrib).to.equal(0);\nawait crowdfunding.connect(owner).endCampaign();\nconst state = await crowdfunding.state();\nexpect(state).to.equal(2);\nconsole.log(\&quot;State akhir: Failed (2)\&quot;);\nconsole.log(\&quot;✅ Test (c) berhasil - Campaign Failed tanpa dana dari awal.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9d7cbc34-3668-46d3-b1de-208cd112cc2d&quot;,&quot;parentUUID&quot;:&quot;51023c19-b527-4bf5-a46b-9d2d573545d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if owner tries to end campaign while donations exist&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - endCampaign() should revert if owner tries to end campaign while donations exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (d): Owner mencoba end campaign dengan dana masih tersisa ===\&quot;);\nawait crowdfunding.connect(backer1).fund({ value: ethers.parseEther(\&quot;3\&quot;) });\nconst goal = await crowdfunding.goal();\nconst totalContrib = await crowdfunding.totalContributions();\nconsole.log(`Goal: ${ethers.formatEther(goal)} ETH`);\nconsole.log(`TotalContributions: ${ethers.formatEther(totalContrib)} ETH`);\nawait expect(crowdfunding.connect(owner).endCampaign()).to.be.revertedWith(\n    \&quot;All funds must be withdrawn.\&quot;\n);\nconsole.log(\&quot;✅ Test (d) berhasil - End campaign ditolak karena masih ada dana.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1e85b507-b2bb-4dba-b9a3-2d548a954604&quot;,&quot;parentUUID&quot;:&quot;51023c19-b527-4bf5-a46b-9d2d573545d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6270b48f-10bd-44df-b983-9d0a981dfae6&quot;,&quot;1d2c9b46-c294-4242-9894-4193856502b5&quot;,&quot;9d7cbc34-3668-46d3-b1de-208cd112cc2d&quot;,&quot;1e85b507-b2bb-4dba-b9a3-2d548a954604&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:22,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:40000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;10.8.2&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:true,&quot;reportFilename&quot;:&quot;fund-test-report&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:false,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:false,&quot;code&quot;:true},&quot;version&quot;:&quot;7.1.4&quot;},&quot;marge&quot;:{&quot;options&quot;:{&quot;reportDir&quot;:&quot;mochawesome-report&quot;,&quot;reportFilename&quot;:&quot;fund-test-report&quot;,&quot;quiet&quot;:true,&quot;overwrite&quot;:true,&quot;html&quot;:true,&quot;json&quot;:false},&quot;version&quot;:&quot;6.3.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;fund-test-report&quot;,&quot;reportDir&quot;:&quot;mochawesome-report&quot;,&quot;reportTitle&quot;:&quot;helpchain-be&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:false,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;mochawesome-report\\assets&quot;,&quot;htmlFile&quot;:&quot;C:\\MB Files\\Projects\\Portfolio Projects Website\\HelpChain Website\\helpchain-be\\mochawesome-report\\fund-test-report.html&quot;}"><div id="report"></div><script src="assets\app.js"></script></body></html>