<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets\app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:8,&quot;tests&quot;:21,&quot;passes&quot;:21,&quot;pending&quot;:0,&quot;failures&quot;:0,&quot;start&quot;:&quot;2025-10-31T10:17:30.826Z&quot;,&quot;end&quot;:&quot;2025-10-31T10:17:31.329Z&quot;,&quot;duration&quot;:503,&quot;testsRegistered&quot;:21,&quot;passPercent&quot;:100,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false},&quot;results&quot;:[{&quot;uuid&quot;:&quot;d1f596f6-343d-4c6c-9720-364dc8e89539&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;902c0ab3-e271-42f3-9b1a-acf2d8329e30&quot;,&quot;title&quot;:&quot;CrowdfundingFactory.sol - createCampaign()&quot;,&quot;fullFile&quot;:&quot;C:\\MB Files\\Projects\\Portfolio Projects Website\\HelpChain Website\\helpchain-be\\test\\1-crowdfundingFactoryCreateCampaign.test.js&quot;,&quot;file&quot;:&quot;\\test\\1-crowdfundingFactoryCreateCampaign.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;CrowdfundingFactory.sol - createCampaign()\&quot;&quot;,&quot;fullTitle&quot;:&quot;CrowdfundingFactory.sol - createCampaign() \&quot;before each\&quot; hook in \&quot;CrowdfundingFactory.sol - createCampaign()\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:83,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;[owner, user1] = await ethers.getSigners();\nCrowdfundingFactory = await ethers.getContractFactory(\&quot;CrowdfundingFactory\&quot;);\nfactory = await CrowdfundingFactory.deploy();\nawait factory.waitForDeployment();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7fc93374-afc7-4337-b7d6-cfe05040b8c5&quot;,&quot;parentUUID&quot;:&quot;902c0ab3-e271-42f3-9b1a-acf2d8329e30&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should create a new campaign successfully&quot;,&quot;fullTitle&quot;:&quot;CrowdfundingFactory.sol - createCampaign() should create a new campaign successfully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji Owner membuat campaign baru ===\&quot;);\nawait factory.connect(user1).createCampaign(\n    \&quot;Education Aid\&quot;,\n    \&quot;Bantuan pendidikan untuk anak kurang mampu\&quot;,\n    ethers.parseEther(\&quot;5\&quot;)\n);\nconst campaigns = await factory.getAllCampaigns();\nconst createdCampaign = campaigns[0];\nexpect(campaigns.length).to.equal(1);\nexpect(createdCampaign.campaignAddress).to.properAddress;\nexpect(createdCampaign.owner).to.equal(user1.address);\nconsole.log(`Alamat Campaign Baru: ${createdCampaign.campaignAddress}`);\nconsole.log(`Pemilik Campaign: ${createdCampaign.owner}`);\nconsole.log(\&quot;✅ Test berhasil - Campaign baru berhasil dibuat.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;69073405-6c7b-48c2-9cbb-a3f10a145889&quot;,&quot;parentUUID&quot;:&quot;902c0ab3-e271-42f3-9b1a-acf2d8329e30&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;69073405-6c7b-48c2-9cbb-a3f10a145889&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:14,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;309a4f56-106c-449a-90f1-e40ede2971fd&quot;,&quot;title&quot;:&quot;Crowdfunding.sol - fund()&quot;,&quot;fullFile&quot;:&quot;C:\\MB Files\\Projects\\Portfolio Projects Website\\HelpChain Website\\helpchain-be\\test\\2-crowdfundingFund.test.js&quot;,&quot;file&quot;:&quot;\\test\\2-crowdfundingFund.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - fund()\&quot;&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - fund() \&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - fund()\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;[owner, backer1, backer2] = await ethers.getSigners();\nCrowdfunding = await ethers.getContractFactory(\&quot;Crowdfunding\&quot;);\ncrowdfunding = await Crowdfunding.deploy(\n    owner.address,\n    \&quot;Clean Water Project\&quot;,\n    \&quot;Pembangunan sumur air bersih untuk desa terpencil\&quot;,\n    1000\n);\nawait crowdfunding.waitForDeployment();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3058bf5e-6d01-407f-8ced-008c9ea6370c&quot;,&quot;parentUUID&quot;:&quot;309a4f56-106c-449a-90f1-e40ede2971fd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should accept valid donations and update total contributions&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - fund() should accept valid donations and update total contributions&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const donationAmount = 100;\nconsole.log(\&quot;\\n=== Kasus Uji (a): Donasi &gt; 0 ETH ===\&quot;);\n// lakukan transaksi donasi dari backer1\nconst tx = await crowdfunding.connect(backer1).fund({ value: donationAmount });\nconst receipt = await tx.wait();\nconsole.log(`Tx Hash: ${receipt.hash}`);\nconsole.log(`Gas Used: ${receipt.gasUsed.toString()}`);\n// tampilkan event yang dipicu\nconst event = receipt.logs\n    .map((log) =&gt; {\n        try {\n            return crowdfunding.interface.parseLog(log);\n        } catch {\n            return null;\n        }\n    })\n    .filter((e) =&gt; e &amp;&amp; e.name === \&quot;DonationReceived\&quot;)[0];\nif (event) {\n    console.log(`Event emitted: ${event.name}`);\n    console.log(` - backer: ${event.args.backer}`);\n    console.log(` - amount: ${event.args.amount.toString()}`);\n    console.log(` - timestamp: ${event.args.timestamp.toString()}`);\n} else {\n    console.log(\&quot;⚠️  Event DonationReceived tidak ditemukan.\&quot;);\n}\n// verifikasi saldo kontrak meningkat\nconst contractBalance = await ethers.provider.getBalance(crowdfunding.target);\nconsole.log(`Saldo kontrak setelah donasi: ${contractBalance.toString()}`);\nexpect(contractBalance).to.equal(donationAmount);\n// verifikasi totalContributions bertambah sesuai\nconst totalContributions = await crowdfunding.totalContributions();\nconsole.log(`Total kontribusi tercatat: ${totalContributions.toString()}`);\nexpect(totalContributions).to.equal(donationAmount);\n// verifikasi bahwa data backer tercatat\nconst backerData = await crowdfunding.backers(backer1.address);\nconsole.log(`Saldo kontribusi backer: ${backerData.totalContribution.toString()}`);\nexpect(backerData.totalContribution).to.equal(donationAmount);\nconsole.log(\&quot;✅ Test (a) berhasil - transaksi donasi tercatat dengan benar.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;00a7b218-c8d9-467f-97ae-6e4fbe7a1cf9&quot;,&quot;parentUUID&quot;:&quot;309a4f56-106c-449a-90f1-e40ede2971fd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if donation amount is zero&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - fund() should revert if donation amount is zero&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (b): Donasi = 0 ETH ===\&quot;);\nawait expect(\n    crowdfunding.connect(backer2).fund({ value: 0 })\n).to.be.revertedWith(\&quot;Must fund amount greater than 0.\&quot;);\nconsole.log(\&quot;✅ Test (b) berhasil - transaksi ditolak sesuai logika.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cb2ba77a-018e-43bd-87bd-99b51f4140fd&quot;,&quot;parentUUID&quot;:&quot;309a4f56-106c-449a-90f1-e40ede2971fd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;00a7b218-c8d9-467f-97ae-6e4fbe7a1cf9&quot;,&quot;cb2ba77a-018e-43bd-87bd-99b51f4140fd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:27,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;7714dc83-80a4-4792-9282-cf36f5046e6e&quot;,&quot;title&quot;:&quot;Crowdfunding.sol - createWithdrawRequest()&quot;,&quot;fullFile&quot;:&quot;C:\\MB Files\\Projects\\Portfolio Projects Website\\HelpChain Website\\helpchain-be\\test\\3-crowdfundingCreateWithdrawRequest.test.js&quot;,&quot;file&quot;:&quot;\\test\\3-crowdfundingCreateWithdrawRequest.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - createWithdrawRequest()\&quot;&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - createWithdrawRequest() \&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - createWithdrawRequest()\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;[owner, backer1, backer2] = await ethers.getSigners();\nCrowdfunding = await ethers.getContractFactory(\&quot;Crowdfunding\&quot;);\ncrowdfunding = await Crowdfunding.deploy(\n    owner.address,\n    \&quot;Clean Water Project\&quot;,\n    \&quot;Pembangunan sumur air bersih untuk desa terpencil\&quot;,\n    1000\n);\nawait crowdfunding.waitForDeployment();\n// Tambah saldo kontrak biar bisa buat withdraw request\nawait crowdfunding.connect(backer1).fund({ value: 500 });\nawait crowdfunding.connect(backer2).fund({ value: 700 });&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;344d787f-0a30-48cd-9f9f-3dd0ae436591&quot;,&quot;parentUUID&quot;:&quot;7714dc83-80a4-4792-9282-cf36f5046e6e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should allow owner to create a valid withdraw request&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - createWithdrawRequest() should allow owner to create a valid withdraw request&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (a): Owner membuat request pertama ===\&quot;);\nconst withdrawAmount = 300;\nconst votingDuration = 60; // 60 detik (dummy)\nconst tx = await crowdfunding\n    .connect(owner)\n    .createWithdrawRequest(withdrawAmount, votingDuration);\nconst receipt = await tx.wait();\nconsole.log(`Tx Hash: ${receipt.hash}`);\nconsole.log(`Gas Used: ${receipt.gasUsed.toString()}`);\n// Cek event WithdrawRequested\nconst event = receipt.logs\n    .map((log) =&gt; {\n        try {\n            return crowdfunding.interface.parseLog(log);\n        } catch {\n            return null;\n        }\n    })\n    .filter((e) =&gt; e &amp;&amp; e.name === \&quot;WithdrawRequested\&quot;)[0];\nif (event) {\n    console.log(`Event emitted: ${event.name}`);\n    console.log(` - requestId: ${event.args.requestId.toString()}`);\n    console.log(` - amount: ${event.args.amount.toString()}`);\n    console.log(` - deadline: ${event.args.deadline.toString()}`);\n} else {\n    console.log(\&quot;⚠️ Event WithdrawRequested tidak ditemukan.\&quot;);\n}\nconst count = await crowdfunding.withdrawRequestCount();\nexpect(count).to.equal(1);\nconsole.log(\&quot;✅ Test (a) berhasil - request pertama dibuat dengan benar.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;094bb539-5308-4afa-a9bf-682032515a02&quot;,&quot;parentUUID&quot;:&quot;7714dc83-80a4-4792-9282-cf36f5046e6e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if non-owner tries to create a request&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - createWithdrawRequest() should revert if non-owner tries to create a request&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (b): Non-owner mencoba membuat request ===\&quot;);\nconst withdrawAmount = 200;\nconst votingDuration = 60;\nawait expect(\n    crowdfunding\n        .connect(backer1)\n        .createWithdrawRequest(withdrawAmount, votingDuration)\n).to.be.revertedWith(\&quot;You are not the owner.\&quot;);\nconsole.log(\&quot;✅ Test (b) berhasil - Non-owner ditolak sesuai logika.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d79b09ef-79e4-4029-be58-ca3ff78c31e3&quot;,&quot;parentUUID&quot;:&quot;7714dc83-80a4-4792-9282-cf36f5046e6e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if owner creates new request before previous finalized&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - createWithdrawRequest() should revert if owner creates new request before previous finalized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\n    \&quot;\\n=== Kasus Uji (c): Owner mencoba request kedua sebelum finalize ===\&quot;\n);\nconst withdrawAmount = 300;\nconst votingDuration = 60;\n// Buat request pertama\nawait crowdfunding\n    .connect(owner)\n    .createWithdrawRequest(withdrawAmount, votingDuration);\n// Coba langsung buat request kedua tanpa finalize\nawait expect(\n    crowdfunding\n        .connect(owner)\n        .createWithdrawRequest(200, 60)\n).to.be.revertedWith(\&quot;Previous request not finalized.\&quot;);\nconsole.log(\&quot;✅ Test (c) berhasil - request kedua ditolak karena belum finalize.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ad8450bd-787a-43bf-a1a3-f861498bc70e&quot;,&quot;parentUUID&quot;:&quot;7714dc83-80a4-4792-9282-cf36f5046e6e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;094bb539-5308-4afa-a9bf-682032515a02&quot;,&quot;d79b09ef-79e4-4029-be58-ca3ff78c31e3&quot;,&quot;ad8450bd-787a-43bf-a1a3-f861498bc70e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:14,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;381cc8d8-0db1-439c-93b6-5c25011d59d1&quot;,&quot;title&quot;:&quot;Crowdfunding.sol - confirmWithdrawRequest()&quot;,&quot;fullFile&quot;:&quot;C:\\MB Files\\Projects\\Portfolio Projects Website\\HelpChain Website\\helpchain-be\\test\\4-crowdfundingConfirmWithdrawRequest.test.js&quot;,&quot;file&quot;:&quot;\\test\\4-crowdfundingConfirmWithdrawRequest.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - confirmWithdrawRequest()\&quot;&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - confirmWithdrawRequest() \&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - confirmWithdrawRequest()\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;[owner, backer1, backer2, outsider] = await ethers.getSigners();\nCrowdfunding = await ethers.getContractFactory(\&quot;Crowdfunding\&quot;);\ncrowdfunding = await Crowdfunding.deploy(\n    owner.address,\n    \&quot;Clean Water Project\&quot;,\n    \&quot;Pembangunan sumur air bersih untuk desa terpencil\&quot;,\n    1000\n);\nawait crowdfunding.waitForDeployment();\n// Fund contract\nawait crowdfunding.connect(backer1).fund({ value: 500 });\nawait crowdfunding.connect(backer2).fund({ value: 700 });\n// Owner creates withdraw request (valid)\nconst withdrawAmount = 300;\nconst votingDuration = 60;\nawait crowdfunding\n    .connect(owner)\n    .createWithdrawRequest(withdrawAmount, votingDuration);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8fdd5dcd-4a8d-4098-8ef4-472492e314a0&quot;,&quot;parentUUID&quot;:&quot;381cc8d8-0db1-439c-93b6-5c25011d59d1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should allow backer to vote YES and emit event&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - confirmWithdrawRequest() should allow backer to vote YES and emit event&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (a): Backer vote YES ===\&quot;);\nconst tx = await crowdfunding.connect(backer1).confirmWithdrawRequest(1, true);\nconst receipt = await tx.wait();\nconsole.log(`Tx Hash: ${receipt.hash}`);\nconsole.log(`Gas Used: ${receipt.gasUsed.toString()}`);\n// Decode event\nconst event = receipt.logs\n    .map((log) =&gt; {\n        try {\n            return crowdfunding.interface.parseLog(log);\n        } catch {\n            return null;\n        }\n    })\n    .filter((e) =&gt; e &amp;&amp; e.name === \&quot;WithdrawConfirmed\&quot;)[0];\nif (event) {\n    console.log(`Event emitted: ${event.name}`);\n    console.log(` - requestId: ${event.args.requestId.toString()}`);\n    console.log(` - backer: ${event.args.backer}`);\n    console.log(` - approve: ${event.args.approve}`);\n    console.log(` - weight: ${event.args.weight.toString()}`);\n}\n// Verify weight = totalContribution\nconst backerData = await crowdfunding.backers(backer1.address);\nexpect(event.args.weight).to.equal(backerData.totalContribution);\n// Verify vote stored as YES (1)\nconst vote = await crowdfunding.getVote(1, backer1.address);\nexpect(vote).to.equal(1);\nconsole.log(\&quot;✅ Test (a) berhasil - voting YES tercatat dengan bobot sesuai kontribusi.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2ab42e85-81ca-44ed-9676-c9fd183b0901&quot;,&quot;parentUUID&quot;:&quot;381cc8d8-0db1-439c-93b6-5c25011d59d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow backer to vote NO and record correctly&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - confirmWithdrawRequest() should allow backer to vote NO and record correctly&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (b): Backer vote NO ===\&quot;);\nconst tx = await crowdfunding.connect(backer2).confirmWithdrawRequest(1, false);\nconst receipt = await tx.wait();\nconsole.log(`Tx Hash: ${receipt.hash}`);\nconsole.log(`Gas Used: ${receipt.gasUsed.toString()}`);\nconst event = receipt.logs\n    .map((log) =&gt; {\n        try {\n            return crowdfunding.interface.parseLog(log);\n        } catch {\n            return null;\n        }\n    })\n    .filter((e) =&gt; e &amp;&amp; e.name === \&quot;WithdrawConfirmed\&quot;)[0];\nif (event) {\n    console.log(`Event emitted: ${event.name}`);\n    console.log(` - requestId: ${event.args.requestId.toString()}`);\n    console.log(` - backer: ${event.args.backer}`);\n    console.log(` - approve: ${event.args.approve}`);\n    console.log(` - weight: ${event.args.weight.toString()}`);\n}\n// Verify NO vote stored (2)\nconst vote = await crowdfunding.getVote(1, backer2.address);\nexpect(vote).to.equal(2);\nconsole.log(\&quot;✅ Test (b) berhasil - voting NO tercatat dengan benar.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;beaaaa85-6696-4d7e-a076-7157529b1807&quot;,&quot;parentUUID&quot;:&quot;381cc8d8-0db1-439c-93b6-5c25011d59d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if non-backer tries to vote&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - confirmWithdrawRequest() should revert if non-backer tries to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (c): Non-backer mencoba vote ===\&quot;);\nawait expect(\n    crowdfunding.connect(outsider).confirmWithdrawRequest(1, true)\n).to.be.revertedWith(\&quot;Not a backer.\&quot;);\nconsole.log(\&quot;✅ Test (c) berhasil - Non-backer ditolak sesuai logika.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;233dfeb7-7fab-493b-8cc7-f0d78e9c0fd8&quot;,&quot;parentUUID&quot;:&quot;381cc8d8-0db1-439c-93b6-5c25011d59d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if backer tries to vote twice&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - confirmWithdrawRequest() should revert if backer tries to vote twice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (d): Backer mencoba vote dua kali ===\&quot;);\n// First vote\nawait crowdfunding.connect(backer1).confirmWithdrawRequest(1, true);\n// Second vote attempt\nawait expect(\n    crowdfunding.connect(backer1).confirmWithdrawRequest(1, false)\n).to.be.revertedWith(\&quot;Already confirmed.\&quot;);\nconsole.log(\&quot;✅ Test (d) berhasil - voting kedua ditolak.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;731f1702-38ad-4c71-a293-42399aa1837d&quot;,&quot;parentUUID&quot;:&quot;381cc8d8-0db1-439c-93b6-5c25011d59d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2ab42e85-81ca-44ed-9676-c9fd183b0901&quot;,&quot;beaaaa85-6696-4d7e-a076-7157529b1807&quot;,&quot;233dfeb7-7fab-493b-8cc7-f0d78e9c0fd8&quot;,&quot;731f1702-38ad-4c71-a293-42399aa1837d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:13,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;02ff3daa-4f9e-42db-afb5-7c4e622e3194&quot;,&quot;title&quot;:&quot;Crowdfunding.sol - finalizeWithdrawRequest()&quot;,&quot;fullFile&quot;:&quot;C:\\MB Files\\Projects\\Portfolio Projects Website\\HelpChain Website\\helpchain-be\\test\\5-crowdfundingFinalizeWithdrawRequest.test.js&quot;,&quot;file&quot;:&quot;\\test\\5-crowdfundingFinalizeWithdrawRequest.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - finalizeWithdrawRequest()\&quot;&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - finalizeWithdrawRequest() \&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - finalizeWithdrawRequest()\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;[owner, backer1, backer2] = await ethers.getSigners();\nCrowdfunding = await ethers.getContractFactory(\&quot;Crowdfunding\&quot;);\ncrowdfunding = await Crowdfunding.deploy(\n    owner.address,\n    \&quot;Clean Water Project\&quot;,\n    \&quot;Pembangunan sumur air bersih untuk desa terpencil\&quot;,\n    ethers.parseEther(\&quot;10\&quot;)\n);\nawait crowdfunding.waitForDeployment();\n// Backers fund total 10 ETH\nawait crowdfunding.connect(backer1).fund({ value: ethers.parseEther(\&quot;4\&quot;) });\nawait crowdfunding.connect(backer2).fund({ value: ethers.parseEther(\&quot;6\&quot;) });\n// Owner creates withdraw request\nconst withdrawAmount = ethers.parseEther(\&quot;5\&quot;); // request 5 ETH\nconst votingDuration = 1; // 1 detik\nawait crowdfunding.connect(owner).createWithdrawRequest(withdrawAmount, votingDuration);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3b6df659-a3b3-4064-bf95-6dbab4f2bd4b&quot;,&quot;parentUUID&quot;:&quot;02ff3daa-4f9e-42db-afb5-7c4e622e3194&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should finalize successfully when YES votes are enough&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - finalizeWithdrawRequest() should finalize successfully when YES votes are enough&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (a): Voting mayoritas YES, pencairan berhasil ===\&quot;);\n// Backer1 vote YES\nawait crowdfunding.connect(backer1).confirmWithdrawRequest(1, true);\n// Backer2 tidak vote (anggap implicit YES)\n// Tunggu votingDuration berakhir\nawait ethers.provider.send(\&quot;evm_increaseTime\&quot;, [2]);\nawait ethers.provider.send(\&quot;evm_mine\&quot;);\n// Cek saldo owner sebelum finalize\nconst balanceBefore = await ethers.provider.getBalance(owner.address);\nconst tx = await crowdfunding.connect(owner).finalizeWithdrawRequest(1);\nconst receipt = await tx.wait();\nconsole.log(`Tx Hash: ${receipt.hash}`);\nconsole.log(`Gas Used: ${receipt.gasUsed.toString()}`);\n// Cek event WithdrawFinalized\nconst event = receipt.logs\n    .map((log) =&gt; {\n        try {\n            return crowdfunding.interface.parseLog(log);\n        } catch {\n            return null;\n        }\n    })\n    .filter((e) =&gt; e &amp;&amp; e.name === \&quot;WithdrawFinalized\&quot;)[0];\nif (event) {\n    console.log(`Event emitted: ${event.name}`);\n    console.log(` - requestId: ${event.args.requestId.toString()}`);\n    console.log(` - success: ${event.args.success}`);\n} else {\n    console.log(\&quot;⚠️ Event WithdrawFinalized tidak ditemukan.\&quot;);\n}\n// Verifikasi event success = true\nexpect(event.args.success).to.be.true;\n// Verifikasi saldo kontrak berkurang\nconst contractBalance = await ethers.provider.getBalance(crowdfunding.target);\nconsole.log(`Saldo kontrak setelah finalize: ${ethers.formatEther(contractBalance)} ETH`);\nexpect(contractBalance).to.equal(ethers.parseEther(\&quot;5\&quot;)); // 10 - 5 ETH withdrawn\n// Verifikasi owner menerima dana\nconst balanceAfter = await ethers.provider.getBalance(owner.address);\nexpect(balanceAfter).to.be.gt(balanceBefore);\nconsole.log(\&quot;✅ Test (a) berhasil - Dana dicairkan karena voting mayoritas YES.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;23226655-619f-43de-8a3d-ff0577ca9af1&quot;,&quot;parentUUID&quot;:&quot;02ff3daa-4f9e-42db-afb5-7c4e622e3194&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should mark campaign Failed when YES votes are not enough&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - finalizeWithdrawRequest() should mark campaign Failed when YES votes are not enough&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (b): Voting mayoritas NO, kampanye gagal ===\&quot;);\n// Backer1 vote NO\nawait crowdfunding.connect(backer1).confirmWithdrawRequest(1, false);\n// Backer2 vote NO\nawait crowdfunding.connect(backer2).confirmWithdrawRequest(1, false);\n// Tunggu waktu voting selesai\nawait ethers.provider.send(\&quot;evm_increaseTime\&quot;, [2]);\nawait ethers.provider.send(\&quot;evm_mine\&quot;);\n// Finalize withdraw (should fail)\nconst tx = await crowdfunding.connect(owner).finalizeWithdrawRequest(1);\nconst receipt = await tx.wait();\nconsole.log(`Tx Hash: ${receipt.hash}`);\nconsole.log(`Gas Used: ${receipt.gasUsed.toString()}`);\nconst event = receipt.logs\n    .map((log) =&gt; {\n        try {\n            return crowdfunding.interface.parseLog(log);\n        } catch {\n            return null;\n        }\n    })\n    .filter((e) =&gt; e &amp;&amp; e.name === \&quot;WithdrawFinalized\&quot;)[0];\nif (event) {\n    console.log(`Event emitted: ${event.name}`);\n    console.log(` - requestId: ${event.args.requestId.toString()}`);\n    console.log(` - success: ${event.args.success}`);\n}\n// Cek state campaign\nconst state = await crowdfunding.state();\nexpect(state).to.equal(2); // 0=Active, 1=Completed, 2=Failed\nexpect(event.args.success).to.be.false;\nconsole.log(\&quot;✅ Test (b) berhasil - Voting tidak mencukupi, campaign gagal.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8c8bf11c-0080-4614-b45b-c00cf138e37a&quot;,&quot;parentUUID&quot;:&quot;02ff3daa-4f9e-42db-afb5-7c4e622e3194&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;23226655-619f-43de-8a3d-ff0577ca9af1&quot;,&quot;8c8bf11c-0080-4614-b45b-c00cf138e37a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:13,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;573e23f0-cc60-49e0-b30b-8205ee3843ba&quot;,&quot;title&quot;:&quot;Crowdfunding.sol - submitProof()&quot;,&quot;fullFile&quot;:&quot;C:\\MB Files\\Projects\\Portfolio Projects Website\\HelpChain Website\\helpchain-be\\test\\6-crowdfundingSubmitProof.test.js&quot;,&quot;file&quot;:&quot;\\test\\6-crowdfundingSubmitProof.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - submitProof()\&quot;&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - submitProof() \&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - submitProof()\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;[owner, backer1, backer2] = await ethers.getSigners();\nCrowdfunding = await ethers.getContractFactory(\&quot;Crowdfunding\&quot;);\ncrowdfunding = await Crowdfunding.deploy(\n    owner.address,\n    \&quot;Clean Water Project\&quot;,\n    \&quot;Pembangunan sumur air bersih untuk desa terpencil\&quot;,\n    ethers.parseEther(\&quot;10\&quot;)\n);\nawait crowdfunding.waitForDeployment();\n// Fund campaign\nawait crowdfunding.connect(backer1).fund({ value: ethers.parseEther(\&quot;4\&quot;) });\nawait crowdfunding.connect(backer2).fund({ value: ethers.parseEther(\&quot;6\&quot;) });\n// Buat withdraw request\nawait crowdfunding\n    .connect(owner)\n    .createWithdrawRequest(ethers.parseEther(\&quot;5\&quot;), 1);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d1425f6b-d379-4dab-b3ae-b36b4fa4c56c&quot;,&quot;parentUUID&quot;:&quot;573e23f0-cc60-49e0-b30b-8205ee3843ba&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should revert if proof submitted before finalize&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - submitProof() should revert if proof submitted before finalize&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (a): Submit proof sebelum finalize ===\&quot;);\nawait expect(\n    crowdfunding.connect(owner).submitProof(1)\n).to.be.revertedWith(\&quot;Request not finalized yet.\&quot;);\nconsole.log(\&quot;✅ Test (a) berhasil - Submit sebelum finalize ditolak.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;17bbfe1f-4914-4075-b41b-4ab11eb4fc55&quot;,&quot;parentUUID&quot;:&quot;573e23f0-cc60-49e0-b30b-8205ee3843ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow proof submission after finalize and emit event&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - submitProof() should allow proof submission after finalize and emit event&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (b): Submit proof setelah finalize ===\&quot;);\n// Voting mayoritas YES → agar bisa finalize sukses\nawait crowdfunding.connect(backer1).confirmWithdrawRequest(1, true);\n// Tunggu voting selesai\nawait ethers.provider.send(\&quot;evm_increaseTime\&quot;, [2]);\nawait ethers.provider.send(\&quot;evm_mine\&quot;);\n// Finalize request\nawait crowdfunding.connect(owner).finalizeWithdrawRequest(1);\n// Sekarang submit proof\nconst tx = await crowdfunding.connect(owner).submitProof(1);\nconst receipt = await tx.wait();\nconsole.log(`Tx Hash: ${receipt.hash}`);\nconsole.log(`Gas Used: ${receipt.gasUsed.toString()}`);\n// Ambil event ProofSubmitted\nconst event = receipt.logs\n    .map((log) =&gt; {\n        try {\n            return crowdfunding.interface.parseLog(log);\n        } catch {\n            return null;\n        }\n    })\n    .filter((e) =&gt; e &amp;&amp; e.name === \&quot;ProofSubmitted\&quot;)[0];\nif (event) {\n    console.log(`Event emitted: ${event.name}`);\n    console.log(` - requestId: ${event.args.requestId.toString()}`);\n    console.log(` - timestamp: ${event.args.timestamp.toString()}`);\n} else {\n    console.log(\&quot;⚠️ Event ProofSubmitted tidak ditemukan.\&quot;);\n}\n// Verifikasi status proofSubmitted = true\nconst requestData = await crowdfunding.getWithdrawRequest(1);\nexpect(requestData.proofSubmitted).to.be.true;\nconsole.log(\&quot;✅ Test (b) berhasil - Proof berhasil disubmit setelah finalize.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;47206883-3cc0-4706-ac3a-10b6bef495ff&quot;,&quot;parentUUID&quot;:&quot;573e23f0-cc60-49e0-b30b-8205ee3843ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;17bbfe1f-4914-4075-b41b-4ab11eb4fc55&quot;,&quot;47206883-3cc0-4706-ac3a-10b6bef495ff&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:7,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;59da9ae4-3c27-4d44-8103-0b32a9b9c44f&quot;,&quot;title&quot;:&quot;Crowdfunding.sol - refund()&quot;,&quot;fullFile&quot;:&quot;C:\\MB Files\\Projects\\Portfolio Projects Website\\HelpChain Website\\helpchain-be\\test\\7-crowdfundingRefund.test.js&quot;,&quot;file&quot;:&quot;\\test\\7-crowdfundingRefund.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - refund()\&quot;&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - refund() \&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - refund()\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;[owner, backer1, backer2, outsider] = await ethers.getSigners();\nCrowdfunding = await ethers.getContractFactory(\&quot;Crowdfunding\&quot;);\ncrowdfunding = await Crowdfunding.deploy(\n    owner.address,\n    \&quot;Clean Water Project\&quot;,\n    \&quot;Pembangunan sumur air bersih untuk desa terpencil\&quot;,\n    ethers.parseEther(\&quot;10\&quot;)\n);\nawait crowdfunding.waitForDeployment();\n// Tambahkan dana ke campaign\nawait crowdfunding.connect(backer1).fund({ value: ethers.parseEther(\&quot;4\&quot;) });\nawait crowdfunding.connect(backer2).fund({ value: ethers.parseEther(\&quot;6\&quot;) });\n// Owner buat withdraw request (5 ETH)\nawait crowdfunding\n    .connect(owner)\n    .createWithdrawRequest(ethers.parseEther(\&quot;5\&quot;), 1);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;72d0590c-8115-480a-a4b9-f559a7224ea4&quot;,&quot;parentUUID&quot;:&quot;59da9ae4-3c27-4d44-8103-0b32a9b9c44f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should allow refund when campaign failed&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - refund() should allow refund when campaign failed&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (a): Refund karena campaign gagal ===\&quot;);\n// Voting mayoritas NO agar gagal\nawait crowdfunding.connect(backer1).confirmWithdrawRequest(1, false);\nawait crowdfunding.connect(backer2).confirmWithdrawRequest(1, false);\n// Tunggu waktu voting berakhir\nawait ethers.provider.send(\&quot;evm_increaseTime\&quot;, [2]);\nawait ethers.provider.send(\&quot;evm_mine\&quot;);\n// Finalize (akan gagal)\nawait crowdfunding.connect(owner).finalizeWithdrawRequest(1);\n// Refund oleh backer1\nconst tx = await crowdfunding.connect(backer1).refund();\nconst receipt = await tx.wait();\nconsole.log(`Tx Hash: ${receipt.hash}`);\nconsole.log(`Gas Used: ${receipt.gasUsed.toString()}`);\n// Ambil event RefundClaimed\nconst event = receipt.logs\n    .map((log) =&gt; {\n        try {\n            return crowdfunding.interface.parseLog(log);\n        } catch {\n            return null;\n        }\n    })\n    .filter((e) =&gt; e &amp;&amp; e.name === \&quot;RefundClaimed\&quot;)[0];\nif (event) {\n    console.log(`Event emitted: ${event.name}`);\n    console.log(` - backer: ${event.args.backer}`);\n    console.log(` - amount: ${ethers.formatEther(event.args.amount)} ETH`);\n}\n// Verifikasi totalContribution jadi 0\nconst backerData = await crowdfunding.backers(backer1.address);\nexpect(backerData.totalContribution).to.equal(0);\nconsole.log(\&quot;✅ Test (a) berhasil - Refund sukses karena campaign gagal.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c152fd73-055a-469d-8142-ca444c4c801b&quot;,&quot;parentUUID&quot;:&quot;59da9ae4-3c27-4d44-8103-0b32a9b9c44f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow refund if backer voted NO even if campaign still active&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - refund() should allow refund if backer voted NO even if campaign still active&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (b): Refund karena backer vote NO ===\&quot;);\n// Backer1 vote NO, backer2 YES\nawait crowdfunding.connect(backer1).confirmWithdrawRequest(1, false);\nawait crowdfunding.connect(backer2).confirmWithdrawRequest(1, true);\n// Belum finalize → masih state Active\nconst stateBefore = await crowdfunding.state();\nexpect(stateBefore).to.equal(0);\n// Backer1 refund karena pernah vote NO\nconst tx = await crowdfunding.connect(backer1).refund();\nconst receipt = await tx.wait();\nconst event = receipt.logs\n    .map((log) =&gt; {\n        try {\n            return crowdfunding.interface.parseLog(log);\n        } catch {\n            return null;\n        }\n    })\n    .filter((e) =&gt; e &amp;&amp; e.name === \&quot;RefundClaimed\&quot;)[0];\nconsole.log(`Event emitted: ${event.name}`);\nconsole.log(` - backer: ${event.args.backer}`);\nconsole.log(` - amount: ${ethers.formatEther(event.args.amount)} ETH`);\nconst backerData = await crowdfunding.backers(backer1.address);\nexpect(backerData.totalContribution).to.equal(0);\nconsole.log(\&quot;✅ Test (b) berhasil - Backer dengan vote NO dapat refund.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0106964a-efb7-4574-99e9-12f8083ef5c0&quot;,&quot;parentUUID&quot;:&quot;59da9ae4-3c27-4d44-8103-0b32a9b9c44f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if backer has no refund rights&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - refund() should revert if backer has no refund rights&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (c): Refund gagal karena tidak memenuhi syarat ===\&quot;);\n// Belum voting apa pun, campaign masih active\nawait expect(\n    crowdfunding.connect(backer2).refund()\n).to.be.revertedWith(\&quot;Refund not allowed.\&quot;);\nconsole.log(\&quot;✅ Test (c) berhasil - Refund ditolak untuk backer tanpa hak.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f14d53ec-dad6-4e23-8a8f-d1c1a7fa88ee&quot;,&quot;parentUUID&quot;:&quot;59da9ae4-3c27-4d44-8103-0b32a9b9c44f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c152fd73-055a-469d-8142-ca444c4c801b&quot;,&quot;0106964a-efb7-4574-99e9-12f8083ef5c0&quot;,&quot;f14d53ec-dad6-4e23-8a8f-d1c1a7fa88ee&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:14,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;5e042957-a043-4b8b-9fe8-047339eb0480&quot;,&quot;title&quot;:&quot;Crowdfunding.sol - endCampaign()&quot;,&quot;fullFile&quot;:&quot;C:\\MB Files\\Projects\\Portfolio Projects Website\\HelpChain Website\\helpchain-be\\test\\8-crowdfundingEndCampaign.test.js&quot;,&quot;file&quot;:&quot;\\test\\8-crowdfundingEndCampaign.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - endCampaign()\&quot;&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - endCampaign() \&quot;before each\&quot; hook in \&quot;Crowdfunding.sol - endCampaign()\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;[owner, backer1, backer2] = await ethers.getSigners();\nCrowdfunding = await ethers.getContractFactory(\&quot;Crowdfunding\&quot;);\ncrowdfunding = await Crowdfunding.deploy(\n    owner.address,\n    \&quot;Clean Water Project\&quot;,\n    \&quot;Pembangunan sumur air bersih untuk desa terpencil\&quot;,\n    ethers.parseEther(\&quot;10\&quot;) // goal = 10 ETH\n);\nawait crowdfunding.waitForDeployment();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bc872775-a9e8-40cc-a033-86bf9730a414&quot;,&quot;parentUUID&quot;:&quot;5e042957-a043-4b8b-9fe8-047339eb0480&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should mark campaign as Completed when goal reached and all funds withdrawn&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - endCampaign() should mark campaign as Completed when goal reached and all funds withdrawn&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (a): Campaign Completed karena goal tercapai ===\&quot;);\nawait crowdfunding.connect(backer1).fund({ value: ethers.parseEther(\&quot;4\&quot;) });\nawait crowdfunding.connect(backer2).fund({ value: ethers.parseEther(\&quot;6\&quot;) });\nconst goal = await crowdfunding.goal();\nconst totalBefore = await crowdfunding.totalContributions();\nconsole.log(`Goal: ${ethers.formatEther(goal)} ETH`);\nconsole.log(`TotalContributions sebelum endCampaign: ${ethers.formatEther(totalBefore)} ETH`);\nawait crowdfunding\n    .connect(owner)\n    .createWithdrawRequest(ethers.parseEther(\&quot;10\&quot;), 1);\nawait crowdfunding.connect(backer1).confirmWithdrawRequest(1, true);\nawait crowdfunding.connect(backer2).confirmWithdrawRequest(1, true);\nawait ethers.provider.send(\&quot;evm_increaseTime\&quot;, [2]);\nawait ethers.provider.send(\&quot;evm_mine\&quot;);\nawait crowdfunding.connect(owner).finalizeWithdrawRequest(1);\nconst totalAfterFinalize = await crowdfunding.totalContributions();\nconsole.log(`TotalContributions setelah finalize: ${ethers.formatEther(totalAfterFinalize)} ETH`);\nawait crowdfunding.connect(owner).endCampaign();\nconst state = await crowdfunding.state();\nexpect(state).to.equal(1);\nconsole.log(\&quot;State akhir: Completed (1)\&quot;);\nconsole.log(\&quot;✅ Test (a) berhasil - Campaign Completed.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;90bfcf27-cd41-49fb-81ab-1b279f235a28&quot;,&quot;parentUUID&quot;:&quot;5e042957-a043-4b8b-9fe8-047339eb0480&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if trying to end campaign while funds remain&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - endCampaign() should revert if trying to end campaign while funds remain&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (b): Gagal end campaign karena masih ada dana ===\&quot;);\nawait crowdfunding.connect(backer1).fund({ value: ethers.parseEther(\&quot;5\&quot;) });\nconst goal = await crowdfunding.goal();\nconst total = await crowdfunding.totalContributions();\nconsole.log(`Goal: ${ethers.formatEther(goal)} ETH`);\nconsole.log(`TotalContributions: ${ethers.formatEther(total)} ETH`);\nawait expect(crowdfunding.connect(owner).endCampaign()).to.be.revertedWith(\n    \&quot;All funds must be withdrawn.\&quot;\n);\nconsole.log(\&quot;✅ Test (b) berhasil - Tidak bisa end campaign sebelum dana kosong.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;47a1cfe2-0a95-4a73-965d-190a67d87564&quot;,&quot;parentUUID&quot;:&quot;5e042957-a043-4b8b-9fe8-047339eb0480&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow endCampaign() and mark as Failed if goal not reached but totalContributions already zero&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - endCampaign() should allow endCampaign() and mark as Failed if goal not reached but totalContributions already zero&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (c): Campaign Failed - goal tidak tercapai namun saldo kosong ===\&quot;);\nconst goal = await crowdfunding.goal();\nconst totalContrib = await crowdfunding.totalContributions();\nconsole.log(`Goal: ${ethers.formatEther(goal)} ETH`);\nconsole.log(`TotalContributions: ${ethers.formatEther(totalContrib)} ETH`);\nexpect(totalContrib).to.equal(0);\nawait crowdfunding.connect(owner).endCampaign();\nconst state = await crowdfunding.state();\nexpect(state).to.equal(2);\nconsole.log(\&quot;State akhir: Failed (2)\&quot;);\nconsole.log(\&quot;✅ Test (c) berhasil - Campaign Failed tanpa dana dari awal.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;709fc3da-1771-48be-b180-569c1a5c12bb&quot;,&quot;parentUUID&quot;:&quot;5e042957-a043-4b8b-9fe8-047339eb0480&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if owner tries to end campaign while donations exist&quot;,&quot;fullTitle&quot;:&quot;Crowdfunding.sol - endCampaign() should revert if owner tries to end campaign while donations exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;console.log(\&quot;\\n=== Kasus Uji (d): Owner mencoba end campaign dengan dana masih tersisa ===\&quot;);\nawait crowdfunding.connect(backer1).fund({ value: ethers.parseEther(\&quot;3\&quot;) });\nconst goal = await crowdfunding.goal();\nconst totalContrib = await crowdfunding.totalContributions();\nconsole.log(`Goal: ${ethers.formatEther(goal)} ETH`);\nconsole.log(`TotalContributions: ${ethers.formatEther(totalContrib)} ETH`);\nawait expect(crowdfunding.connect(owner).endCampaign()).to.be.revertedWith(\n    \&quot;All funds must be withdrawn.\&quot;\n);\nconsole.log(\&quot;✅ Test (d) berhasil - End campaign ditolak karena masih ada dana.\\n\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4b6e5b13-6f1e-4442-b03e-e80b6d0f52a2&quot;,&quot;parentUUID&quot;:&quot;5e042957-a043-4b8b-9fe8-047339eb0480&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;90bfcf27-cd41-49fb-81ab-1b279f235a28&quot;,&quot;47a1cfe2-0a95-4a73-965d-190a67d87564&quot;,&quot;709fc3da-1771-48be-b180-569c1a5c12bb&quot;,&quot;4b6e5b13-6f1e-4442-b03e-e80b6d0f52a2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:26,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:40000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;10.8.2&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:true,&quot;reportFilename&quot;:&quot;fund-test-report&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:false,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:false,&quot;code&quot;:true},&quot;version&quot;:&quot;7.1.4&quot;},&quot;marge&quot;:{&quot;options&quot;:{&quot;reportDir&quot;:&quot;mochawesome-report&quot;,&quot;reportFilename&quot;:&quot;fund-test-report&quot;,&quot;quiet&quot;:true,&quot;overwrite&quot;:true,&quot;html&quot;:true,&quot;json&quot;:false},&quot;version&quot;:&quot;6.3.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;fund-test-report&quot;,&quot;reportDir&quot;:&quot;mochawesome-report&quot;,&quot;reportTitle&quot;:&quot;helpchain-be&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:false,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;mochawesome-report\\assets&quot;,&quot;htmlFile&quot;:&quot;C:\\MB Files\\Projects\\Portfolio Projects Website\\HelpChain Website\\helpchain-be\\mochawesome-report\\fund-test-report.html&quot;}"><div id="report"></div><script src="assets\app.js"></script></body></html>